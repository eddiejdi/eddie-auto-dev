name: Auto-assign agent + validator

on:
  issue_comment:
    types: [created]

jobs:
  assign:
    runs-on: ubuntu-latest
    steps:
      - name: Assign assignees from comment
        uses: actions/github-script@v6
        with:
          script: |
            const comment = context.payload.comment.body.trim();
            const assignRegex = /^\/assign\s+@?([A-Za-z0-9\-]+)(?:\s+--final)?/i;
            const m = comment.match(assignRegex);
            if (!m) {
              core.info('No assign command found.');
              return;
            }
            const userToAssign = m[1];
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const issue_number = context.payload.issue.number;
            const assignees = [userToAssign, 'edenilson'];

            try {
              await github.issues.addAssignees({ owner, repo, issue_number, assignees });
              await github.issues.createComment({ owner, repo, issue_number,
                body: `Atribuído: @${userToAssign} e @edenilson para validação final.` });
            } catch (err) {
              core.setFailed(`Falha ao atribuir: ${err.message}`);
            }
