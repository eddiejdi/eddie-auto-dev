name: CI Monitor
true:
  schedule:
  - cron: '*/15 * * * *'
  workflow_dispatch: null
jobs:
  monitor:
    runs-on: ubuntu-latest
    steps:
    - name: Run CI monitor (comment on PRs with failing runs)
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: "const owner = context.repo.owner;\nconst repo = context.repo.repo;\n\
          \n// list open PRs\nconst prs = await github.rest.pulls.list({ owner, repo,\
          \ state: 'open', per_page: 100 });\nfor (const pr of prs.data) {\n  const\
          \ sha = pr.head.sha;\n\n  // find workflow runs for this head sha\n  const\
          \ runsResp = await github.rest.actions.listWorkflowRunsForRepo({ owner,\
          \ repo, per_page: 200 });\n  const runs = runsResp.data.workflow_runs.filter(r\
          \ => r.head_sha === sha);\n\n  const failing = runs.filter(r => r.conclusion\
          \ === 'failure');\n  if (failing.length > 0) {\n    const max = Math.min(5,\
          \ failing.length);\n    let body = `\u26A0\uFE0F *Automated CI Monitor*:\
          \ encontrei ${failing.length} workflow(s) com falha para esta PR (sha: ${sha}).\\\
          n\\n`;\n    body += failing.slice(0, max).map(r => `- **${r.name}** \u2014\
          \ ${r.conclusion} \u2014 ${r.html_url}`).join('\\n');\n    body += '\\n\\\
          nSe quiser, re-execute os runs problem\xE1ticos ou verifique os logs.';\n\
          \n    // post a comment (creates one per run; acceptable for now)\n    await\
          \ github.rest.issues.createComment({ owner, repo, issue_number: pr.number,\
          \ body });\n  }\n}\n"
  selenium-e2e:
    name: Selenium E2E
    uses: ./.github/workflows/selenium-tests.yml
