app = "homelab-tunnel-sparkling-sun-3565"
primary_region = "gru"  # São Paulo

[build]
  dockerfile = "Dockerfile"

[env]
  # Endereço IPv6 do homelab na rede privada Fly6PN (WireGuard)
  # Usando portas do ipv6-proxy.py que escuta em IPv6 e faz forward para localhost
  HOMELAB_HOST = "[fdaa:3b:60e0:a7b:8cfe:0:a:102]"
  # Portas mapeadas pelo ipv6-proxy.py:
  # 8081 -> 3000 (Open WebUI)
  # 8082 -> 11434 (Ollama)
  # 8083 -> 8001 (RAG API)
  # 8084 -> 8501 (RAG Dashboard)
  # 8085 -> 8502 (GitHub Agent)
  OLLAMA_PORT = "8082"
  RAG_DASHBOARD_PORT = "8084"
  GITHUB_AGENT_PORT = "8085"
  RAG_API_PORT = "8083"
  WEBUI_PORT = "8081"

[http_service]
  internal_port = 8080
  force_https = true
  force_https = true
  # Minimize resource usage to fit free quota: allow Fly to stop machines when idle
  auto_stop_machines = true
  auto_start_machines = true
  # Allow zero machines running when idle to avoid billable hours
  min_machines_running = 0
  processes = ["app"]

  [http_service.concurrency]
    type = "requests"
    # Reduce concurrency to lower burst capacity and limit resource consumption
    hard_limit = 100
    soft_limit = 50

[[vm]]
  memory = "256mb"
  cpu_kind = "shared"
  cpus = 1
