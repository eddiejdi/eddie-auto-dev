# Cloudflare Tunnel Configuration for RPA4ALL IDE
# Location: ~/.cloudflared/config.yml (on homelab server 192.168.15.2)
# 
# Setup instructions:
# 1. Install: curl -L https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64.deb -o cloudflared.deb && sudo dpkg -i cloudflared.deb
# 2. Login: cloudflared tunnel login
# 3. Create tunnel: cloudflared tunnel create rpa4all-ide
# 4. Copy this config to: ~/.cloudflared/config.yml
# 5. Update tunnel ID and credentials-file path below
# 6. Add DNS record in Cloudflare dashboard (or use: cloudflared tunnel route dns rpa4all-ide ide.rpa4all.com)
# 7. Install service: sudo cloudflared service install
# 8. Start: sudo systemctl start cloudflared

# Replace <TUNNEL_ID> with your actual tunnel ID (from step 3)
tunnel: <TUNNEL_ID>
credentials-file: /root/.cloudflared/<TUNNEL_ID>.json

# Ingress rules - order matters!
ingress:
  # IDE static site (HTML/CSS/JS)
  - hostname: ide.rpa4all.com
    service: http://127.0.0.1:8081
    originRequest:
      noTLSVerify: false
      connectTimeout: 30s
      
  # Code Runner API (Python execution backend)
  - hostname: api.rpa4all.com
    path: /code-runner/*
    service: http://127.0.0.1:2000
    originRequest:
      noTLSVerify: false
      connectTimeout: 60s
      
  # Specialized Agents API
  - hostname: api.rpa4all.com
    path: /agents-api/*
    service: http://127.0.0.1:8503
    originRequest:
      noTLSVerify: false
      connectTimeout: 60s
      
  # Open WebUI (already configured)
  - hostname: openwebui.rpa4all.com
    service: http://127.0.0.1:3000
    originRequest:
      noTLSVerify: false
      
  # Grafana dashboards
  - hostname: grafana.rpa4all.com
    service: http://127.0.0.1:3001
    originRequest:
      noTLSVerify: false
      
  # Catch-all (required by cloudflared)
  - service: http_status:404

# Logging
loglevel: info
logfile: /var/log/cloudflared.log

# Performance tuning
no-autoupdate: false
grace-period: 30s
